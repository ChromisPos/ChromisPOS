<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog

    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">


    <property name="boolean.type" value="boolean" dbms="derby, postgresql, hypersql, hsqldb"/>
    <property name="boolean.type" value="bit" dbms="mysql"/>
    <property name="boolean.type" value="numeric(1)" dbms="oracle"/>

    <property name="blob.type" value="blob" dbms="oracle, derby, hypersql, hsqldb"/>
    <property name="blob.type" value="bytea" dbms="postgresql"/>
    <property name="blob.type" value="mediumblob" dbms="mysql"/>
  
    <include file="uk/chromis/pos/liquibase/dbpermissions.xml"/>  
     
    <!-- ***************************************************************************************** --> 
    <!-- ***************************************************************************************** --> 
    <!-- Using the liquibase scripts.
        
         The liquibase script has now been broken down into sections. There are some sections that
         remain as they are, due to the order of historic processing. and errors that would be
         created by modifying these.
         If the size of the script decome unmanagablem additional scripts will be created.
        
         When there is a need to add any new changes into the liquibase scripts.
         DO NOT, change an existing changeset, this will change the MD5 signature for the change
         and will then prevent the scrip from running throwing a liquibase error.
    
    Please read the comments before each section -->
    
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->    
    <!-- Need to enure that all columns are present before attempting to refactor for deriby
    Once refactored all columns will be added with new format
    DO NOT MOVE OR ADD TO THIS SECTION -->
    <changeSet author="Chromis POS" id="Add PrintkB if not found" dbms="postgresql, hypersql, hsqldb">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="PRINTKB" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="PRINTKB" type="${boolean.type}" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet> 

    <changeSet author="Chromis POS" id="Add PrintkB if not found m" dbms="mysql, oracle">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="PRINTKB" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="PRINTKB" type="${boolean.type}" defaultValueNumeric="1" >
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet> 

    <changeSet author="Chromis POS" id="Add PrintkB if not found d" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="PRINTKB" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="PRINTKB" type="SMALLINT" defaultValueNumeric="1" >
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet> 

    <changeSet author="Chromis POS" id="Add SENDSTATUS if not found" dbms="postgresql, hypersql, hsqldb">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="SENDSTATUS" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="SENDSTATUS" type="${boolean.type}" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet> 

    <changeSet author="Chromis POS" id="Add SENDSTATUS if not found m" dbms="mysql, oracle">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="SENDSTATUS" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="SENDSTATUS" type="${boolean.type}" defaultValueNumeric="1" >
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet> 

    <changeSet author="Chromis POS" id="Add SENDSTATUS if not found d" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="SENDSTATUS" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="SENDSTATUS" type="SMALLINT" defaultValueNumeric="1" >
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet>
    <!-- End of refactoring preperation -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->    
    <!-- Refactors derby database to use update driver for boolean 
    Any columns that used 'int' will be converted to use true/false.
    DO NOT CHANGE THIS SECTION -->    
    <changeSet author="Chromis POS" id="Refactor People table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>  
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="VISIBLE"
            tableName="PEOPLE"/>
  
        <addColumn tableName="PEOPLE">
            <column name="VISIBLE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PEOPLE SET VISIBLE='TRUE' WHERE JDL_TMP=1;
            UPDATE PEOPLE SET VISIBLE='FALSE' WHERE JDL_TMP=0
        </sql>
        
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PEOPLE"/>
    </changeSet>  
    
    <changeSet author="Chromis POS" id="Refactor Breaks table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions> 
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="VISIBLE"
            tableName="BREAKS"/>
  
        <addColumn tableName="BREAKS">
            <column name="VISIBLE" type="boolean"/>
        </addColumn>
        
        <sql>
            UPDATE BREAKS SET VISIBLE='TRUE' WHERE JDL_TMP=1;
            UPDATE BREAKS SET VISIBLE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="BREAKS"/>
    </changeSet>            
      
    <changeSet author="Chromis POS" id="Refactor CUSTOMER table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions> 
    
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="VISIBLE"
            tableName="CUSTOMERS"/>
  
        <addColumn tableName="CUSTOMERS">
            <column name="VISIBLE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE CUSTOMERS SET VISIBLE='TRUE' WHERE JDL_TMP=1;
            UPDATE CUSTOMERS SET VISIBLE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="CUSTOMERS"/>
    </changeSet>      
        
    <changeSet author="Chromis POS" id="Refactor Moorers table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>        

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="POWER"
            tableName="MOORERS"/>
  
        <addColumn tableName="MOORERS">
            <column name="POWER" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE MOORERS SET POWER='TRUE' WHERE JDL_TMP=1;
            UPDATE MOORERS SET POWER='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="MOORERS"/>
    </changeSet>      
        
    <changeSet author="Chromis POS" id="Refactor Places table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>   

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="TABLEMOVED"
            tableName="PLACES"/>
  
        <addColumn tableName="PLACES">
            <column name="TABLEMOVED" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PLACES SET TABLEMOVED='TRUE' WHERE JDL_TMP=1;
            UPDATE PLACES SET TABLEMOVED='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PLACES"/>
    </changeSet>        
        
    <changeSet author="Chromis POS" id="Refactor Catergories table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>    

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="CATSHOWNAME"
            tableName="CATEGORIES"/>
  
        <addColumn tableName="CATEGORIES">
            <column name="CATSHOWNAME" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE CATEGORIES SET CATSHOWNAME='TRUE' WHERE JDL_TMP=1;
            UPDATE CATEGORIES SET CATSHOWNAME='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="CATEGORIES"/>
    </changeSet>         
        
    <changeSet author="Chromis POS" id="Refactor Taxes table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>     

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="RATECASCADE"
            tableName="TAXES"/>
  
        <addColumn tableName="TAXES">
            <column name="RATECASCADE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE TAXES SET RATECASCADE='TRUE' WHERE JDL_TMP=1;
            UPDATE TAXES SET RATECASCADE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="TAXES"/>
    </changeSet>         
        
    <changeSet author="Chromis POS" id="Refactor Reservations table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>    

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISDONE"
            tableName="RESERVATIONS"/>
  
        <addColumn tableName="RESERVATIONS">
            <column name="ISDONE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE RESERVATIONS SET ISDONE='TRUE' WHERE JDL_TMP=1;
            UPDATE RESERVATIONS SET ISDONE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="RESERVATIONS"/>
    </changeSet>         
        
    
    <changeSet author="Chromis POS" id="Refactor Products table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>  

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISCOM"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISCOM" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISCOM='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISCOM='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISSCALE"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISSCALE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISSCALE='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISSCALE='FALSE' WHERE JDL_TMP=0    
        </sql>                    
        
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISKITCHEN"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISKITCHEN" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISKITCHEN='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISKITCHEN='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>        
  
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="PRINTKB"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="PRINTKB" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET PRINTKB='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET PRINTKB='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>      
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="SENDSTATUS"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="SENDSTATUS" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET SENDSTATUS='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET SENDSTATUS='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>       
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISSERVICE"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISSERVICE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISSERVICE='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISSERVICE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>        
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISVERPATRIB"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISVERPATRIB" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISVERPATRIB='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISVERPATRIB='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>        
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISVPRICE"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISVPRICE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISVPRICE='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISVPRICE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>       
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="WARRANTY"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="WARRANTY" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET WARRANTY='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET WARRANTY='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>        
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="CANDISCOUNT"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="CANDISCOUNT" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET CANDISCOUNT='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET CANDISCOUNT='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>         
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ALWAYSAVAILABLE"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ALWAYSAVAILABLE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ALWAYSAVAILABLE='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ALWAYSAVAILABLE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>         

        <sql>
            INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, EXECTYPE, MD5SUM, DESCRIPTION, LIQUIBASE) 
            VALUES (
            'derby10.10.20',
            'Chromis POS', 
            'uk/chromis/pos/liquibase/udpdatecreatedb.xml', 
            '2015-10-23 22:43:33.487',
            0,
            'EXECUTED',
            '7:d41d8cd98f00b204e9800998ecf8427e',
            'empty',                       
            '3.5.0-Chromis Mod')                
        </sql>
    </changeSet>     
    <!-- End of  Derby refactoring -->                 
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->    
    <!-- Add any new tables required in this section -->
    <changeSet author="Chromis POS" id="Create StockChanges Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="STOCKCHANGES"/>
            </not>
        </preConditions>

        <createTable tableName="STOCKCHANGES">
            <column name="ID" type="varchar(50)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="LOCATION" type="varchar(255)"/>                
            <column name="USERNAME" type="varchar(50)"/>           
            <column name="UPLOADTIME" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="CHANGES_PRODUCT" type="varchar(255)"/>
            <column name="CHANGES_TYPE" type="int"/>
            <column name="CHANGES_PROCESSED" type="int"/>
            <column name="CHANGES_FIELD" type="varchar(50)"/>
            <column name="CHANGES_TEXTVALUE" type="varchar(255)"/> 
            <column name="CHANGES_BLOBVALUE" type="${blob.type}"/>                                    
        </createTable>       
    </changeSet>   
  
    <changeSet author="Chromis POS" id="Create Voucher Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="VOUCHERS"/>
            </not>
        </preConditions>

        <createTable tableName="VOUCHERS">
            <column name="VOUCHER" type="varchar(50)">
                <constraints primaryKey="true" nullable="false"/>
            </column>           
            <column name="SOLDDATE" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="REDEEMDATE" type="timestamp" />            
            <column name="SOLDTICKETID" type="varchar(50)"/>
            <column name="REDEEMTICKETID" type="varchar(50)"/>                                    
        </createTable>       
    </changeSet>
    
    <changeSet author="Chromis POS" id="Create Orders Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ORDERS"/>
            </not>
        </preConditions>

        <createTable tableName="ORDERS">
            <column name="ID" type="varchar(50)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="ORDERID" type="varchar(50)"/>                
            <column name="QTY" type="int"/>           
            <column name="DETAILS" type="varchar(255)"/>
            <column name="ATTRIBUTES" type="varchar(255)"/>
            <column name="NOTES" type="varchar(255)"/>
            <column name="TICKETID" type="varchar(255)"/>
            <column name="ORDERTIME" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="DISPLAYID" type="int"/>                                    
        </createTable>                         
    </changeSet> 
    
    <changeSet author="Chromis POS" id="Create TICKETSNUM_INVOICE Sequence." dbms="postgresql, hypersql, hsqldb">
        <preConditions onFail="MARK_RAN">
            <not>
                <sequenceExists sequenceName="TICKETSNUM_INVOICE"/>
            </not>
        </preConditions>
        
        <sql>CREATE SEQUENCE TICKETSNUM_INVOICE START WITH 1</sql>  
    </changeSet>  

    <changeSet author="Chromis Pos" id="Create TICKETSNUM Sequence INVOICE mysql if not found" dbms="mysql">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="TICKETSNUM_INVOICE"/>
            </not>
        </preConditions>
        
        <sql>CREATE TABLE TICKETSNUM_INVOICE (ID INTEGER DEFAULT 0 NOT NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8;
            INSERT INTO TICKETSNUM_INVOICE VALUES(1)</sql>
    </changeSet>

    <changeSet author="Chromis Pos" id="Create TICKETSNUM Sequence INVOICE oracle if not found" dbms="oracle">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="TICKETSNUM_INVOICE"/>
            </not>
        </preConditions>
        
        <sql>CREATE TABLE TICKETSNUM_INVOICE (ID INTEGER DEFAULT 0 NOT NULL);
            INSERT INTO TICKETSNUM_INVOICE VALUES(1)</sql>
    </changeSet>

    <changeSet author="Chromis Pos" id="CCreate TICKETSNUM Sequence INVOICE  derby if not found" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="TICKETSNUM_INVOICE"/>
            </not>
        </preConditions>
        
        <sql>CREATE TABLE TICKETSNUM_INVOICE (ID INTEGER GENERATED ALWAYS AS IDENTITY (START WITH 1));
            INSERT INTO TICKETSNUM_INVOICE VALUES (DEFAULT)</sql>
    </changeSet>

    <changeSet author="Chromis POS" id="Drop faulty STOCKCHANGES Table" >    
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="CHANGES_TEXTVALUE" tableName="STOCKCHANGES"/>
        </preConditions> 
        <dropTable tableName="STOCKCHANGES"/>
    </changeSet> 
                           
    <changeSet author="Chromis POS" id="Create new STOCKCHANGES Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="STOCKCHANGES"/>
            </not>
        </preConditions>
        
        <createTable tableName="STOCKCHANGES">
            <column name="ID" type="varchar(100)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="LOCATION" type="varchar(255)"/>                
            <column name="USERNAME" type="varchar(50)"/>           
            <column name="UPLOADTIME" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="PRODUCTID" type="varchar(255)"/>
            <column name="CHANGETYPE" type="int"/>
            <column name="DISPLAY" type="varchar(255)"/>
            <column name="FIELD" type="varchar(50)"/>
            <column name="TEXTVALUE" type="varchar(255)"/> 
            <column name="BLOBVALUE" type="${blob.type}"/>                                    
            <column name="CHANGES_PROCESSED" type="int"/>
        </createTable>       
    </changeSet>   

    <changeSet author="Chromis POS" id="Create Promotion Table">       
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROMOTIONS"/>
            </not>
        </preConditions> 
        
        <createTable tableName="PROMOTIONS">
            <column name="ID" type="varchar(50)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="NAME" type="varchar(255)" >
                <constraints nullable="false" />                
            </column>
            <column name="CRITERIA"  type="${blob.type}"/>           
            <column name="SCRIPT"  type="${blob.type}" >
                <constraints nullable="false" />
            </column>
            <column name="ALLPRODUCTS" type="${boolean.type}"   
                    defaultValueBoolean="false"/>  
            <column name="ISENABLED" type="${boolean.type}" 
                    defaultValueBoolean="true"/>
        </createTable>      
    </changeSet>   
                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    <changeSet author="Chromis POS" id="Create Historic Version Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="HVERSIONS"/>
            </not>
        </preConditions>

        <createTable tableName="HVERSIONS">
            <column name="VERSION" type="varchar(50)"> 
                <constraints primaryKey="true"/>
            </column>
        </createTable>       
    </changeSet>                                                                                                                                                                                                                                                                                                                                                                                                                                              
    <!-- End of new tables sections -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->   
    <!-- Add any new columns or column data chnages required in this section --> 
    <changeSet author="Chromis POS" id="Create ISCATALOG into PRODUCTS" >    
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ISCATALOG" tableName="PRODUCTS"/>
            </not>
        </preConditions> 
                       
        <addColumn tableName="PRODUCTS">            
            <column name="ISCATALOG" type="${boolean.type}" />
            <column name="CATORDER" type="integer"/>
        </addColumn>                                                     
    </changeSet>  
    
    <changeSet author="Chromis POS" id="Create flag into PRODUCTS_CAT" >    
        <preConditions onFail="MARK_RAN">         
            <tableExists tableName="PRODUCTS_CAT"/>
            <not>
                <columnExists columnName="FLAG" tableName="PRODUCTS_CAT"/>                
            </not>
        </preConditions> 
                       
        <addColumn tableName="PRODUCTS_CAT">
            <column name="FLAG" type="${boolean.type}" 
                    defaultValueBoolean="true"/>
        </addColumn>                                                       
    </changeSet>
 
    <changeSet author="Chromis POS" id="Move PRODUCTS_CAT table into PRODUCTS d " dbms="derby, postgresql, hypersql, hsqldb" > 
        <sql>   
            UPDATE PRODUCTS SET ISCATALOG = FALSE; 
            UPDATE PRODUCTS_CAT SET FLAG = TRUE;        
            UPDATE PRODUCTS SET ISCATALOG = (SELECT FLAG FROM PRODUCTS_CAT WHERE PRODUCTS.ID = PRODUCTS_CAT.PRODUCT),
            CATORDER = (SELECT CATORDER FROM PRODUCTS_CAT WHERE PRODUCTS.ID = PRODUCTS_CAT.PRODUCT); 
            UPDATE PRODUCTS SET ISCATALOG = FALSE WHERE ISCATALOG IS NULL;                                    
        </sql>          
        <addDefaultValue tableName="PRODUCTS" columnName="ISCATALOG" defaultValueBoolean="true" />                  
    </changeSet>
   
    <changeSet author="Chromis POS" id="Move PRODUCTS_CAT table into PRODUCTS m " dbms="mysql, oracle ">
        <sql>
            UPDATE PRODUCTS SET ISCATALOG = 0; 
            UPDATE PRODUCTS_CAT SET FLAG = 1; 
            UPDATE PRODUCTS SET ISCATALOG = (SELECT FLAG FROM PRODUCTS_CAT WHERE PRODUCTS.ID = PRODUCTS_CAT.PRODUCT), 
            CATORDER = (SELECT CATORDER FROM PRODUCTS_CAT WHERE PRODUCTS.ID = PRODUCTS_CAT.PRODUCT);  
            UPDATE PRODUCTS SET ISCATALOG = 0 WHERE ISCATALOG IS NULL;     
        </sql>  
        <addDefaultValue tableName="PRODUCTS" columnName="ISCATALOG" defaultValueNumeric="1" />  
    </changeSet>     
          
    <changeSet author="Chromis POS" id="Add refund qty Ticketlines Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="REFUNDQTY" tableName="TICKETLINES"/>
            </not>
        </preConditions>

        <addColumn tableName="TICKETLINES">
            <column name="REFUNDQTY" type="double precision" defaultValueNumeric="0.0"/>                                                   
        </addColumn>                         
    </changeSet>
    
    <changeSet author="Chromis POS" id="check for Stockunits column">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="STOCKUNITS" tableName="PRODUCTS"/>
            </not>
        </preConditions>     
               
        <addColumn tableName="PRODUCTS">
            <column name="STOCKUNITS" type="double precision" defaultValueNumeric="0"/>
        </addColumn>
    </changeSet>

    <changeSet author="Chromis POS" id="Add Pack Products details p" dbms="postgresql, hypersql, hsqldb">    
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ISPACK" tableName="PRODUCTS"/>
            </not>
        </preConditions>   

        <addColumn tableName="PRODUCTS">
            <column name="ISPACK" type="${boolean.type}" defaultValueBoolean="false" >
                <constraints nullable="false"/>
            </column>
            <column name="PACKQUANTITY" type="double precision"/>
            <column name="PACKPRODUCT" type="varchar(255)"/>
        </addColumn>
    
        <addForeignKeyConstraint baseColumnNames="PACKPRODUCT"
                                 constraintName ="PRODUCTS_PACKPRODUCT_FK"
                                 referencedColumnNames = "ID"
                                 baseTableName="PRODUCTS"
                                 referencedTableName="PRODUCTS"/>    
    </changeSet>           
  
    <changeSet author="Chromis POS" id="Add Pack Products details m" dbms="mysql, oracle">    
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ISPACK" tableName="PRODUCTS"/>
            </not>
        </preConditions>   
           
        <addColumn tableName="PRODUCTS">
            <column name="ISPACK" type="${boolean.type}" defaultValueNumeric="1" >
                <constraints nullable="false"/>
            </column>
            <column name="PACKQUANTITY" type="double precision"/>
            <column name="PACKPRODUCT" type="varchar(255)"/>
        </addColumn>        
        
        <addForeignKeyConstraint baseColumnNames="PACKPRODUCT"
                                 constraintName ="PRODUCTS_PACKPRODUCT_FK"
                                 referencedColumnNames = "ID"
                                 baseTableName="PRODUCTS"
                                 referencedTableName="PRODUCTS"/>  
    </changeSet>        
  
    <changeSet author="Chromis POS" id="Add Pack Products details d" dbms="derby">    
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ISPACK" tableName="PRODUCTS"/>
            </not>
        </preConditions> 
    
        <addColumn tableName="PRODUCTS">
            <column name="ISPACK" type="${boolean.type}" defaultValueBoolean="false" >
                <constraints nullable="false"/>
            </column>
            <column name="PACKQUANTITY" type="double precision"/>
            <column name="PACKPRODUCT" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="Chromis POS" id="Add Auxiliary Column to Orders Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="AUXILIARY" tableName="ORDERS"/>
            </not>
        </preConditions>

        <addColumn tableName="ORDERS">
            <column name="AUXILIARY" type="int"/>                                                   
        </addColumn>                         
    </changeSet>
    
    <changeSet author="Chromis POS" id="check for catorder column in categories table">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="CATORDER" tableName="CATEGORIES" />
            </not>
        </preConditions>     
               
        <addColumn tableName="CATEGORIES">
            <column name="CATORDER" type="integer"/>
        </addColumn>        
    </changeSet>
    
    <changeSet author="Chromis POS" id="Promotions added to PRODUCTS">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="PROMOTIONID" tableName="PRODUCTS" />
            </not>
        </preConditions>     
               
        <addColumn tableName="PRODUCTS">
            <column name="PROMOTIONID" type="varchar(50)" /> 
        </addColumn>     
                       
        <addForeignKeyConstraint baseColumnNames="PROMOTIONID"
                                 constraintName ="FK_PRODUCT_PROMOTIONID"
                                 referencedColumnNames = "ID"
                                 baseTableName="PRODUCTS"
                                 referencedTableName="PROMOTIONS"/>
      
    </changeSet>     
      
    <changeSet author="Chromis POS" id="Add Allproducts column if it does not exist" >    
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="ALLPRODUCTS" tableName="PRODUCTS"/>
        </preConditions> 
        
        <addColumn tableName="PRODUCTS">
            <column name="ALLPRODUCTS" type="${boolean.type}"   
                    defaultValueBoolean="false"/>  
        </addColumn>        
    </changeSet>     
    
    
    <changeSet author="Chromis POS" id="Remove change timestamp when updating" dbms="mysql">     
        <sql>ALTER TABLE SHIFT_BREAKS CHANGE STARTTIME STARTTIME TIMESTAMP NOT null DEFAULT CURRENT_TIMESTAMP</sql>
        <sql>ALTER TABLE CLOSEDCASH CHANGE DATESTART DATESTART TIMESTAMP NOT null DEFAULT CURRENT_TIMESTAMP</sql>
        <sql>ALTER TABLE SHIFTS CHANGE STARTSHIFT STARTSHIFT TIMESTAMP NOT null DEFAULT CURRENT_TIMESTAMP</sql>
        <sql>ALTER TABLE LEAVES CHANGE STARTDATE STARTDATE TIMESTAMP NOT null DEFAULT CURRENT_TIMESTAMP</sql> 
    </changeSet> 
    
    
    <!-- End of new columns sections -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->              
    <!-- Add any new resource changesets to this section --> 
    <changeSet author="Chromis POS" id="Insert into RESOURCES Table">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM RESOURCES WHERE ID='63'</sqlCheck>
        </preConditions>

        <insert tableName="RESOURCES">
            <column name="ID" value="63"/>
            <column name="NAME" value="Printer.TicketRefundPreview"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/Printer.TicketRefundPreview.xml"/>
        </insert>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    </changeSet>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
            
    <changeSet author="Chromis POS" id="Add reportlogo to resources">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM RESOURCES WHERE NAME = 'img.reportlogo'</sqlCheck>
        </preConditions> 
        
        <insert tableName="RESOURCES">
            <column name="ID" value="62"/>
            <column name="NAME" value="img.reportlogo"/>
            <column name="RESTYPE" valueNumeric="1"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/img.reportlogo.png"/>
        </insert>
    </changeSet> 
    
    <changeSet author="Chromis POS" id="Add sql.ActionStockChanges to resources">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM RESOURCES WHERE NAME = 'sql.ActionStockChanges'</sqlCheck>
        </preConditions> 
        
        <insert tableName="RESOURCES">
            <column name="ID" value="64"/>
            <column name="NAME" value="sql.ActionStockChanges"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/sql.ActionStockChanges.txt"/>
        </insert>
    </changeSet> 
    
    <changeSet author="Chromis POS" id="update sql.ActionStockChanges to resources">        
        <update tableName="RESOURCES">
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/sql.ActionStockChanges.txt"/>  
            <where>NAME='sql.ActionStockChanges'</where>      
        </update> 
    </changeSet>                     
                                                       
    <changeSet author="Chromis POS" id="update to to new menu for roles">    
        <update tableName="RESOURCES">
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/Menu.Root.txt"/>  
            <where>NAME='Menu.Root'</where>      
        </update>               
    </changeSet>

    <changeSet author="Chromis POS" id="update 2 sql.ActionStockChanges to resources">        
        <update tableName="RESOURCES">
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/sql.ActionStockChanges.txt"/>  
            <where>NAME='sql.ActionStockChanges'</where>      
        </update> 
    </changeSet>   

    <changeSet author="Chromis POS" id="Add promotion scripts to resources">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM RESOURCES WHERE NAME = 'help.promotion'</sqlCheck>
        </preConditions> 
        
        <insert tableName="RESOURCES">
            <column name="ID" value="6700"/>
            <column name="NAME" value="help.promotion"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/Help.Promotion.txt"/>
        </insert>

        <insert tableName="RESOURCES">
            <column name="ID" value="6701"/>
            <column name="NAME" value="promotion.bogof"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/promotion/scripts/promotion.bogof.txt"/>
        </insert>

        <insert tableName="RESOURCES">
            <column name="ID" value="6702"/>
            <column name="NAME" value="promotion.threefortwo"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/promotion/scripts/promotion.multibuy.txt"/>
        </insert>

        <insert tableName="RESOURCES">
            <column name="ID" value="6703"/>
            <column name="NAME" value="promotion.mealdeal"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/promotion/scripts/promotion.mealdeal.txt"/>
        </insert>

        <insert tableName="RESOURCES">
            <column name="ID" value="6704"/>
            <column name="NAME" value="promotion.percentoff"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/promotion/scripts/promotion.percentoff.txt"/>
        </insert>

        <insert tableName="RESOURCES">
            <column name="ID" value="6705"/>
            <column name="NAME" value="promotion.coupon"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/promotion/scripts/promotion.coupon.txt"/>
        </insert>
    </changeSet>        
        
    <changeSet author="Chromis POS" id="Add display.message scripts to resources">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM RESOURCES WHERE NAME = 'Display.Message'</sqlCheck>
        </preConditions> 
        
        <insert tableName="RESOURCES">
            <column name="ID" value="70"/>
            <column name="NAME" value="Display.Message"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/Display.Message.xml"/>
        </insert>
    </changeSet>   
    
    <changeSet author="Chromis POS" id="Update menu.root for promotions engine">
        <update tableName="RESOURCES">
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/Menu.Root.txt"/>  
            <where>NAME='Menu.Root'</where>      
        </update>         
    </changeSet>
     
    <changeSet author="Chromis POS" id="Update menu.root in to resources">
        <update tableName="RESOURCES">
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/Menu.Root.txt"/>  
            <where>NAME='Menu.Root'</where>      
        </update> 
    </changeSet>   
    
    <changeSet author="Chromis POS" id="Insert ServiceCharge into RESOURCES Table">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM RESOURCES WHERE NAME='script.ServiceCharge'</sqlCheck>
        </preConditions>

        <insert tableName="RESOURCES">
            <column name="ID" value="72"/>
            <column name="NAME" value="script.ServiceCharge"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/script.ServiceCharge.txt"/>
        </insert>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    </changeSet>
    
    <changeSet author="Chromis POS" id="Update service charge script">
        <update tableName="RESOURCES">
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/script.ServiceCharge.txt"/>  
            <where>NAME='script.ServiceCharge'</where>      
        </update>         
    </changeSet>   
    
    <changeSet author="Chromis POS" id="Insert Ticket.CloseTimer into RESOURCES Table">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM RESOURCES WHERE NAME='Ticket.CloseTimer'</sqlCheck>
        </preConditions>

        <insert tableName="RESOURCES">
            <column name="ID" value="73"/>
            <column name="NAME" value="Ticket.CloseTimer"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/Ticket.CloseTimer.xml"/>
        </insert>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    </changeSet>    
    
    <changeSet author="Chromis POS" id="Update refundit script">
        <update tableName="RESOURCES">
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/script.Refundit.txt"/>  
            <where>NAME='script.Refundit'</where>      
        </update>         
    </changeSet>                                                                                                                                                                                                                                                                                          
    <!-- End of resource changeset section   -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->              
    <!-- Add any new dbpermission changesets to this section -->       
    <changeSet author="Chromis POS" id="Add Pack Products permissions"> 
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(0) FROM DBPERMISSIONS WHERE DISPLAYNAME='##label.displayname117'  </sqlCheck>
        </preConditions>
              
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="/uk/chromis/reports/inventoryreorder.bs"/>
            <column name="SECTION" value="##label.sectionstock"/>
            <column name="DISPLAYNAME" value="##label.displayname117"/>
            <column name="DESCRIPTION" value="##label.description117"/>
        </insert>
        
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="uk.chromis.pos.inventory.ProductPacksPanel"/>
            <column name="SECTION" value="##label.sectionstock"/>
            <column name="DISPLAYNAME" value="##label.displayname118"/>
            <column name="DESCRIPTION" value="##label.description118"/>
        </insert>		         
    </changeSet>   
    
    <changeSet author="Chromis POS" id="Add StockChanges to permissions">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM DBPERMISSIONS WHERE DESCRIPTION = '##label.description119'</sqlCheck>
        </preConditions>   
            
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="uk.chromis.pos.imports.StockChangesPanel"/>
            <column name="SECTION" value="##label.sectiontools"/>
            <column name="DISPLAYNAME" value="##label.displayname119"/>
            <column name="DESCRIPTION" value="##label.description119"/>
        </insert>
        		
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="/uk/chromis/reports/stockchanges.bs"/>
            <column name="SECTION" value="##label.sectiontools"/>
            <column name="DISPLAYNAME" value="##label.displayname120"/>
            <column name="DESCRIPTION" value="##label.description120"/>
        </insert>		                 
    </changeSet>    
    
    <changeSet author="Chromis POS" id="Add button.refundeditsale to permissions">   
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(0) FROM DBPERMISSIONS WHERE DISPLAYNAME='##label.displayname121'  </sqlCheck>
        </preConditions>    
         
        <insert tableName="DBPERMISSIONS">
            <column name="CLASSNAME" value="button.refundeditsale"/>
            <column name="SECTION" value="##label.sectionbuttons"/>
            <column name="DISPLAYNAME" value="##label.displayname121"/>
            <column name="DESCRIPTION" value="##label.description121"/>
        </insert>
    </changeSet>
     
    <changeSet author="Chromis POS" id="Add Promotions permissions.">    
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM DBPERMISSIONS WHERE DESCRIPTION = '##label.description122'</sqlCheck>
        </preConditions>   
                                                                           
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="uk.chromis.pos.promotion.PromotionPanel"/>
            <column name="SECTION" value="##label.sectionstock"/>
            <column name="DISPLAYNAME" value="##label.displayname122"/>
            <column name="DESCRIPTION" value="##label.description122"/>
        </insert>
        		
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="/uk/chromis/reports/promotions.bs"/>
            <column name="SECTION" value="##label.sectionstock"/>
            <column name="DISPLAYNAME" value="##label.displayname123"/>
            <column name="DESCRIPTION" value="##label.description123"/>
        </insert> 
    </changeSet> 
    
    <changeSet author="Chromis POS" id="Add Supplier panel permissions">    
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM DBPERMISSIONS WHERE DESCRIPTION = '##label.description124'</sqlCheck>
        </preConditions> 
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="uk.chromis.pos.suppliers.SuppliersPanel"/>
            <column name="SECTION" value="##label.sectionstock"/>
            <column name="DISPLAYNAME" value="##label.displayname124"/>
            <column name="DESCRIPTION" value="##label.description124"/>
        </insert> 
    </changeSet> 
          
    <changeSet author="Chromis POS" id="drop top10salesMysql">  
        <sql> DELETE FROM DBPERMISSIONS WHERE DISPLAYNAME ='##label.displayname86'</sql>           
    </changeSet> 
    <!-- End of dbpermissions changeset section   -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->     
    <!-- Add any new data to tables required in this section. -->    
    <changeSet author="Chromis POS" id="Check the default category still exists">   
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(0) FROM CATEGORIES WHERE ID='000'  </sqlCheck>
        </preConditions>    
         
        <insert tableName="CATEGORIES">
            <column name="ID" value="000"/>
            <column name="NAME" value="Service Charge"/>
            <column name="CATSHOWNAME" valueBoolean="true"/>
        </insert>
    </changeSet>   
                                                                                                                                                                                                                                                                                                                                                                                                                                      
    <changeSet author="Chromis POS" id="Add new Service Charge product to table">   
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(0) FROM PRODUCTS WHERE ID='sc999-001'  </sqlCheck>
        </preConditions>    
         
        <insert tableName="PRODUCTS">
            <column name="ID" value="sc999-001"/>
            <column name="REFERENCE" value="sc999-001"/>
            <column name="CODE" value="sc999-001"/>
            <column name="NAME" value="Service Charge"/>
            <column name="CATEGORY" value="000"/>
            <column name="TAXCAT" value="001"/>
            <column name="ISCATALOG" valueBoolean="false"/>
            <column name="ISSERVICE" valueBoolean="true"/>
            <column name="PRICEBUY" valueNumeric="0.0"/>
            <column name="PRICESELL" valueNumeric="0.0"/>
        </insert>
    </changeSet>                                                                                                                                                                                                                                                                                                          
    <!-- End of dbpermissions changeset section   -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->   
    <!-- Mysql change to InnoDB if required 
         All new tables should be followed by the InnDB change for that table.         
    -->
    <changeSet author="Chromis POS" id="change Mysql tables to InnoDB (if required)" dbms="mysql">            
        <sql>ALTER TABLE APPLICATIONS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTEINSTANCE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTESET ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTESETINSTANCE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTEUSE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTEVALUE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE BREAKS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE CATEGORIES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE CLOSEDCASH ENGINE=InnoDB</sql>
        <sql>ALTER TABLE CSVIMPORT ENGINE=InnoDB</sql>
        <sql>ALTER TABLE CUSTOMERS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE DATABASECHANGELOG ENGINE=InnoDB</sql>
        <sql>ALTER TABLE DATABASECHANGELOGLOCK ENGINE=InnoDB</sql>
        <sql>ALTER TABLE DBPERMISSIONS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE DRAWEROPENED ENGINE=InnoDB</sql>
        <sql>ALTER TABLE FLOORS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE LEAVES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE LINEREMOVED ENGINE=InnoDB</sql>
        <sql>ALTER TABLE LOCATIONS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE MOORERS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PAYMENTS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PEOPLE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PICKUP_NUMBER ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PLACES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PRODUCTS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PRODUCTS_CAT ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PRODUCTS_COM ENGINE=InnoDB</sql>
        <sql>ALTER TABLE RECEIPTS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE RESERVATION_CUSTOMERS	 ENGINE=InnoDB</sql>
        <sql>ALTER TABLE RESERVATIONS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE RESOURCES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ROLES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE SHAREDTICKETS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE SHIFT_BREAKS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE SHIFTS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE STOCKCURRENT ENGINE=InnoDB</sql>
        <sql>ALTER TABLE STOCKDIARY ENGINE=InnoDB</sql>
        <sql>ALTER TABLE STOCKLEVEL ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TAXCATEGORIES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TAXCUSTCATEGORIES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TAXES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TAXLINES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE THIRDPARTIES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TICKETLINES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TICKETS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TICKETSNUM ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TICKETSNUM_PAYMENT ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TICKETSNUM_REFUND ENGINE=InnoDB</sql>      
    </changeSet>    
    
    <changeSet author="Chromis POS" id="change Mysql Voucher-Orders-Stockchanges table to InnoDB (if required)" dbms="mysql">            
        <sql>ALTER TABLE STOCKCHANGES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ORDERS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE VOUCHERS ENGINE=InnoDB</sql>
    </changeSet> 
    
    <changeSet author="Chromis POS" id="change Mysql promotions table to InnoDB (if required)" dbms="mysql">       
        <sql>ALTER TABLE PROMOTIONS ENGINE=InnoDB</sql>
    </changeSet> 
    <!-- End of InnoDB section -->     
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->   
    <!-- Drop any sharedtickets -->
    <!-- If required If it needs to be done after further updates increment number to make unique  -->   
    <changeSet author="Chromis POS" id="drop hversions data" >       
        <sql>DELETE FROM HVERSIONS</sql>
    </changeSet> 

    <changeSet author="Chromis POS" id="drop shared tickets 1" >       
        <sql>DELETE FROM SHAREDTICKETS</sql>
    </changeSet>         
    <!-- End of sharedtickets -->     
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->   
    <!-- Drop any unused tables - must be done last -->   
    <changeSet author="Chromis POS" id="Drop PRODUCTS_CAT table" >    
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="PRODUCTS_CAT"/>
        </preConditions>                        
        <dropTable tableName="PRODUCTS_CAT"/>
    </changeSet> 
    <!-- End of Drop Tables section -->    
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->  
    <!-- Update this section with the latest version number -->
    <!-- Remember to always change the ID details as well -->    
    <changeSet author="Chromis POS" id="Update to 0.54.2">    
        <update tableName="APPLICATIONS">
            <column name="VERSION" value="0.54.2"/>          
        </update>  
    </changeSet>

    <changeSet author="Chromis POS" id="Update Hversions start"> 
        <insert tableName="HVERSIONS"> 
            <column name="VERSION" value="0.54"/>       
        </insert>                   
        <insert tableName="HVERSIONS"> 
            <column name="VERSION" value="0.54.1"/>       
        </insert> 
        <insert tableName="HVERSIONS"> 
            <column name="VERSION" value="0.54.2"/>       
        </insert>         
    </changeSet> 
    <!-- ***************************************************************************************** -->      
</databaseChangeLog>

